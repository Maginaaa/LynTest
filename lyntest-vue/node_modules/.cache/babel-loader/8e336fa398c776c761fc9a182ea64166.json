{"remainingRequest":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/babel-loader/lib/index.js!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/eslint-loader/index.js??ref--13-0!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/component/notify/observer.js","dependencies":[{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/component/notify/observer.js","mtime":1606834545487},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n/* eslint-disable*/\nimport Emitter from './emitter';\n\nvar _default =\n/*#__PURE__*/\nfunction () {\n  function _default(connectionUrl) {\n    var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, _default);\n\n    this.format = opts.format && opts.format.toLowerCase();\n\n    if (connectionUrl.startsWith('//')) {\n      var scheme = window.location.protocol === 'https:' ? 'wss' : 'ws';\n      connectionUrl = \"\".concat(scheme, \":\").concat(connectionUrl);\n    }\n\n    this.connectionUrl = connectionUrl;\n    this.opts = opts;\n    this.reconnection = this.opts.reconnection || false;\n    this.reconnectionAttempts = this.opts.reconnectionAttempts || Infinity;\n    this.reconnectionDelay = this.opts.reconnectionDelay || 1000;\n    this.reconnectTimeoutId = 0;\n    this.reconnectionCount = 0;\n    this.passToStoreHandler = this.opts.passToStoreHandler || false;\n    this.connect(connectionUrl, opts);\n\n    if (opts.store) {\n      this.store = opts.store;\n    }\n\n    if (opts.mutations) {\n      this.mutations = opts.mutations;\n    }\n\n    this.onEvent();\n  }\n\n  _createClass(_default, [{\n    key: \"connect\",\n    value: function connect(connectionUrl) {\n      var _this = this;\n\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var protocol = opts.protocol || '';\n      this.WebSocket = opts.WebSocket || (protocol === '' ? new WebSocket(connectionUrl) : new WebSocket(connectionUrl, protocol));\n\n      if (this.format === 'json') {\n        if (!('sendObj' in this.WebSocket)) {\n          this.WebSocket.sendObj = function (obj) {\n            return _this.WebSocket.send(JSON.stringify(obj));\n          };\n        }\n      }\n\n      return this.WebSocket;\n    }\n  }, {\n    key: \"reconnect\",\n    value: function reconnect() {\n      var _this2 = this;\n\n      if (this.reconnectionCount <= this.reconnectionAttempts) {\n        this.reconnectionCount++;\n        clearTimeout(this.reconnectTimeoutId);\n        this.reconnectTimeoutId = setTimeout(function () {\n          if (_this2.store) {\n            _this2.passToStore('SOCKET_RECONNECT', _this2.reconnectionCount);\n          }\n\n          _this2.connect(_this2.connectionUrl, _this2.opts);\n\n          _this2.onEvent();\n        }, this.reconnectionDelay);\n      } else if (this.store) {\n        this.passToStore('SOCKET_RECONNECT_ERROR', true);\n      }\n    }\n  }, {\n    key: \"onEvent\",\n    value: function onEvent() {\n      var _this3 = this;\n\n      ;\n      ['onmessage', 'onclose', 'onerror', 'onopen'].forEach(function (eventType) {\n        _this3.WebSocket[eventType] = function (event) {\n          Emitter.emit(eventType, event);\n\n          if (_this3.store) {\n            _this3.passToStore(\"SOCKET_\".concat(eventType), event);\n          }\n\n          if (_this3.reconnection && eventType === 'onopen') {\n            _this3.opts.$setInstance(event.currentTarget);\n\n            _this3.reconnectionCount = 0;\n          }\n\n          if (_this3.reconnection && eventType === 'onclose') {\n            _this3.reconnect();\n          }\n        };\n      });\n    }\n  }, {\n    key: \"passToStore\",\n    value: function passToStore(eventName, event) {\n      if (this.passToStoreHandler) {\n        this.passToStoreHandler(eventName, event, this.defaultPassToStore.bind(this));\n      } else {\n        this.defaultPassToStore(eventName, event);\n      }\n    }\n  }, {\n    key: \"defaultPassToStore\",\n    value: function defaultPassToStore(eventName, event) {\n      if (!eventName.startsWith('SOCKET_')) {\n        return;\n      }\n\n      var method = 'commit';\n      var target = eventName.toUpperCase();\n      var msg = event;\n\n      if (this.format === 'json' && event.data) {\n        msg = JSON.parse(event.data);\n\n        if (msg.mutation) {\n          target = [msg.namespace || '', msg.mutation].filter(function (e) {\n            return !!e;\n          }).join('/');\n        } else if (msg.action) {\n          method = 'dispatch';\n          target = [msg.namespace || '', msg.action].filter(function (e) {\n            return !!e;\n          }).join('/');\n        }\n      }\n\n      if (this.mutations) {\n        target = this.mutations[target] || target;\n      }\n\n      this.store[method](target, msg);\n    }\n  }]);\n\n  return _default;\n}();\n\nexport { _default as default };",{"version":3,"sources":["/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/component/notify/observer.js"],"names":["Emitter","connectionUrl","opts","format","toLowerCase","startsWith","scheme","window","location","protocol","reconnection","reconnectionAttempts","Infinity","reconnectionDelay","reconnectTimeoutId","reconnectionCount","passToStoreHandler","connect","store","mutations","onEvent","WebSocket","sendObj","obj","send","JSON","stringify","clearTimeout","setTimeout","passToStore","forEach","eventType","event","emit","$setInstance","currentTarget","reconnect","eventName","defaultPassToStore","bind","method","target","toUpperCase","msg","data","parse","mutation","namespace","filter","e","join","action"],"mappings":"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","sourcesContent":["/* eslint-disable*/\nimport Emitter from './emitter'\n\nexport default class {\n  constructor(connectionUrl, opts = {}) {\n    this.format = opts.format && opts.format.toLowerCase()\n\n    if (connectionUrl.startsWith('//')) {\n      const scheme = window.location.protocol === 'https:' ? 'wss' : 'ws'\n      connectionUrl = `${scheme}:${connectionUrl}`\n    }\n\n    this.connectionUrl = connectionUrl\n    this.opts = opts\n\n    this.reconnection = this.opts.reconnection || false\n    this.reconnectionAttempts = this.opts.reconnectionAttempts || Infinity\n    this.reconnectionDelay = this.opts.reconnectionDelay || 1000\n    this.reconnectTimeoutId = 0\n    this.reconnectionCount = 0\n\n    this.passToStoreHandler = this.opts.passToStoreHandler || false\n\n    this.connect(connectionUrl, opts)\n\n    if (opts.store) {\n      this.store = opts.store\n    }\n    if (opts.mutations) {\n      this.mutations = opts.mutations\n    }\n    this.onEvent()\n  }\n\n  connect(connectionUrl, opts = {}) {\n    const protocol = opts.protocol || ''\n    this.WebSocket =\n      opts.WebSocket || (protocol === '' ? new WebSocket(connectionUrl) : new WebSocket(connectionUrl, protocol))\n    if (this.format === 'json') {\n      if (!('sendObj' in this.WebSocket)) {\n        this.WebSocket.sendObj = obj => this.WebSocket.send(JSON.stringify(obj))\n      }\n    }\n\n    return this.WebSocket\n  }\n\n  reconnect() {\n    if (this.reconnectionCount <= this.reconnectionAttempts) {\n      this.reconnectionCount++\n      clearTimeout(this.reconnectTimeoutId)\n\n      this.reconnectTimeoutId = setTimeout(() => {\n        if (this.store) {\n          this.passToStore('SOCKET_RECONNECT', this.reconnectionCount)\n        }\n\n        this.connect(this.connectionUrl, this.opts)\n        this.onEvent()\n      }, this.reconnectionDelay)\n    } else if (this.store) {\n      this.passToStore('SOCKET_RECONNECT_ERROR', true)\n    }\n  }\n\n  onEvent() {\n    ;['onmessage', 'onclose', 'onerror', 'onopen'].forEach(eventType => {\n      this.WebSocket[eventType] = event => {\n        Emitter.emit(eventType, event)\n\n        if (this.store) {\n          this.passToStore(`SOCKET_${eventType}`, event)\n        }\n\n        if (this.reconnection && eventType === 'onopen') {\n          this.opts.$setInstance(event.currentTarget)\n          this.reconnectionCount = 0\n        }\n\n        if (this.reconnection && eventType === 'onclose') {\n          this.reconnect()\n        }\n      }\n    })\n  }\n\n  passToStore(eventName, event) {\n    if (this.passToStoreHandler) {\n      this.passToStoreHandler(eventName, event, this.defaultPassToStore.bind(this))\n    } else {\n      this.defaultPassToStore(eventName, event)\n    }\n  }\n\n  defaultPassToStore(eventName, event) {\n    if (!eventName.startsWith('SOCKET_')) {\n      return\n    }\n    let method = 'commit'\n    let target = eventName.toUpperCase()\n    let msg = event\n    if (this.format === 'json' && event.data) {\n      msg = JSON.parse(event.data)\n      if (msg.mutation) {\n        target = [msg.namespace || '', msg.mutation].filter(e => !!e).join('/')\n      } else if (msg.action) {\n        method = 'dispatch'\n        target = [msg.namespace || '', msg.action].filter(e => !!e).join('/')\n      }\n    }\n    if (this.mutations) {\n      target = this.mutations[target] || target\n    }\n    this.store[method](target, msg)\n  }\n}\n"]}]}
{"remainingRequest":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/babel-loader/lib/index.js!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/eslint-loader/index.js??ref--13-0!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/store/getter.js","dependencies":[{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/store/getter.js","mtime":1606834545596},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import Util from '@/lin/util/util';\nvar stageMap = {};\n\nvar deepTravel = function deepTravel(obj, fuc) {\n  if (Array.isArray(obj)) {\n    obj.forEach(function (item) {\n      deepTravel(item, fuc);\n    });\n    return;\n  }\n\n  if (obj && obj.children) {\n    fuc(obj);\n    deepTravel(obj.children, fuc);\n    return;\n  }\n\n  if (obj.name) {\n    fuc(obj);\n  }\n};\n\nexport var logined = function logined(state) {\n  return state.logined;\n};\nexport var user = function user(state) {\n  return state.user;\n};\nexport var readedMessages = function readedMessages(state) {\n  return state.readedMessages;\n};\nexport var unreadMessages = function unreadMessages(state) {\n  return state.unreadMessages;\n};\n/**\n * 在侧边栏展示时，如果当前路由 children 属性为空，则删除该路由\n * @param {*} arr 路由配置项数据\n */\n\nfunction IterationDelateMenuChildren(arr) {\n  if (arr.length) {\n    for (var i in arr) {\n      if (arr[i].children && !arr[i].children.length) {\n        delete arr[i];\n      } else if (arr[i].children && arr[i].children.length) {\n        IterationDelateMenuChildren(arr[i].children);\n      }\n    }\n  }\n\n  return arr;\n}\n/**\n * Shaking 掉无限制路由\n * @param {array} stageConfig 路由配置项数据\n * @param {array} permissions 当前登录管理员所拥有的权限集合\n * @param {object} currentUser 当前登录管理员\n */\n\n\nfunction permissionShaking(stageConfig, permissions, currentUser) {\n  var shookConfig = stageConfig.filter(function (route) {\n    if (Util.hasPermission(permissions, route, currentUser)) {\n      if (route.children && route.children.length) {\n        route.children = permissionShaking(route.children, permissions, currentUser);\n      }\n\n      return true;\n    }\n\n    return false;\n  });\n  return IterationDelateMenuChildren(shookConfig);\n} // 获取有权限的舞台配置\n\n\nexport var permissionStageConfig = function permissionStageConfig(state) {\n  var stageConfig = state.stageConfig,\n      permissions = state.permissions,\n      user = state.user; // eslint-disable-line\n\n  var tempStageConfig = Util.deepClone(stageConfig);\n  var shookConfig = permissionShaking(tempStageConfig, permissions, user); // 设置舞台缓存\n\n  var list = {};\n  deepTravel(shookConfig, function (item) {\n    list[item.name] = item;\n  });\n  stageMap = list;\n  return shookConfig;\n}; // 获取侧边栏配置\n\nexport var sideBarList = function sideBarList(state, getter) {\n  var sideBarLevel = state.sideBarLevel; // eslint-disable-line\n\n  var permissionStageConfig = getter.permissionStageConfig; // eslint-disable-line\n\n  function deepGetSideBar(target) {\n    var level = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3;\n\n    // 集合节点处理\n    if (Array.isArray(target)) {\n      var acc = target.map(function (item) {\n        return deepGetSideBar(item, level - 1);\n      });\n      return acc.filter(function (item) {\n        return item !== null;\n      });\n    } // 检测是否需要在导航中显示\n\n\n    if (!target.inNav) {\n      return null;\n    }\n\n    if (target.type === 'folder' && level !== 0) {\n      // 处理 folder 模式\n      var sideConfig = {};\n      sideConfig.name = target.name;\n      sideConfig.title = target.title;\n      sideConfig.icon = target.icon;\n      sideConfig.path = target.route || Util.getRandomStr(6);\n      sideConfig.children = target.children.map(function (item) {\n        return deepGetSideBar(item, level - 1);\n      });\n      sideConfig.children = sideConfig.children.filter(function (item) {\n        return item !== null;\n      });\n      return sideConfig;\n    } // 处理一级就是 view 的情况\n\n\n    if (target.type === 'view') {\n      var _sideConfig = {};\n      _sideConfig.name = target.name;\n      _sideConfig.title = target.title;\n      _sideConfig.icon = target.icon;\n      _sideConfig.path = target.route;\n      return _sideConfig;\n    } // 处理 appTab 情况\n\n\n    if (target.type === 'tab') {\n      var _sideConfig2 = {};\n      _sideConfig2.name = target.name;\n      _sideConfig2.title = target.title;\n      _sideConfig2.icon = target.icon;\n      _sideConfig2.path = target.route; // 如果 Tab 没有设置默认打开的路由, 则设置为第一个子节点路由\n\n      if (!_sideConfig2.path) {\n        if (target.children && target.children.length > 0 && target.children[0].route) {\n          _sideConfig2.path = target.children[0].route;\n        }\n      }\n\n      return _sideConfig2;\n    } // 最后一层, 都当做子节点处理\n\n\n    if (level <= 0) {\n      var _sideConfig3 = {};\n      _sideConfig3.name = target.name;\n      _sideConfig3.title = target.title;\n      _sideConfig3.icon = target.icon;\n      _sideConfig3.path = Util.getRandomStr(6);\n\n      if (target.children && target.children.length > 0 && target.children[0].route) {\n        _sideConfig3.path = target.children[0].route;\n      }\n\n      return _sideConfig3;\n    }\n\n    return null;\n  }\n\n  var sideBar = deepGetSideBar(permissionStageConfig, sideBarLevel);\n  return sideBar;\n}; // 获取有权限的所有节点配置对象\n// eslint-disable-next-line\n\nexport var getStageByName = function getStageByName() {\n  return function (name) {\n    return stageMap[name];\n  };\n}; // 获取有权限的所有节点配置对象\n// eslint-disable-next-line\n\nexport var getStageByRoute = function getStageByRoute() {\n  return function (path) {\n    var result = Object.getOwnPropertySymbols(stageMap).find(function (key) {\n      return stageMap[key].route === path;\n    });\n    return stageMap[result];\n  };\n};\nexport var stageList = function stageList() {\n  return stageMap;\n};\nexport var permissions = function permissions(state) {\n  return state.permissions;\n};\nexport var getStageInfo = function getStageInfo(state) {\n  var stageConfig = state.stageConfig;\n  var cache = {};\n\n  var findStage = function findStage(stages, name) {\n    var result;\n\n    if (Array.isArray(stages)) {\n      for (var i = 0; i < stages.length; i += 1) {\n        result = findStage(stages[i], name);\n\n        if (result) {\n          break;\n        }\n      }\n\n      return result;\n    }\n\n    if (stages.children && stages.children.length) {\n      result = findStage(stages.children, name);\n\n      if (result) {\n        result.unshift(stages);\n      }\n\n      return result;\n    }\n\n    if (stages.name === name) {\n      return [stages];\n    }\n\n    return false;\n  };\n\n  return function (name) {\n    if (cache[name]) {\n      return cache[name];\n    }\n\n    var stageInfo = findStage(stageConfig, name);\n\n    if (stageInfo) {\n      cache[name] = stageInfo;\n    }\n\n    return stageInfo;\n  };\n};",{"version":3,"sources":["/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/store/getter.js"],"names":["Util","stageMap","deepTravel","obj","fuc","Array","isArray","forEach","item","children","name","logined","state","user","readedMessages","unreadMessages","IterationDelateMenuChildren","arr","length","i","permissionShaking","stageConfig","permissions","currentUser","shookConfig","filter","route","hasPermission","permissionStageConfig","tempStageConfig","deepClone","list","sideBarList","getter","sideBarLevel","deepGetSideBar","target","level","acc","map","inNav","type","sideConfig","title","icon","path","getRandomStr","sideBar","getStageByName","getStageByRoute","result","Object","getOwnPropertySymbols","find","key","stageList","getStageInfo","cache","findStage","stages","unshift","stageInfo"],"mappings":"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","sourcesContent":["import Util from '@/lin/util/util'\n\nlet stageMap = {}\n\nconst deepTravel = (obj, fuc) => {\n  if (Array.isArray(obj)) {\n    obj.forEach(item => {\n      deepTravel(item, fuc)\n    })\n    return\n  }\n  if (obj && obj.children) {\n    fuc(obj)\n    deepTravel(obj.children, fuc)\n    return\n  }\n  if (obj.name) {\n    fuc(obj)\n  }\n}\n\nexport const logined = state => state.logined\n\nexport const user = state => state.user\n\nexport const readedMessages = state => state.readedMessages\n\nexport const unreadMessages = state => state.unreadMessages\n\n/**\n * 在侧边栏展示时，如果当前路由 children 属性为空，则删除该路由\n * @param {*} arr 路由配置项数据\n */\nfunction IterationDelateMenuChildren(arr) {\n  if (arr.length) {\n    for (const i in arr) {\n      if (arr[i].children && !arr[i].children.length) {\n        delete arr[i]\n      } else if (arr[i].children && arr[i].children.length) {\n        IterationDelateMenuChildren(arr[i].children)\n      }\n    }\n  }\n  return arr\n}\n\n/**\n * Shaking 掉无限制路由\n * @param {array} stageConfig 路由配置项数据\n * @param {array} permissions 当前登录管理员所拥有的权限集合\n * @param {object} currentUser 当前登录管理员\n */\nfunction permissionShaking(stageConfig, permissions, currentUser) {\n  const shookConfig = stageConfig.filter(route => {\n    if (Util.hasPermission(permissions, route, currentUser)) {\n      if (route.children && route.children.length) {\n        route.children = permissionShaking(route.children, permissions, currentUser)\n      }\n      return true\n    }\n    return false\n  })\n  return IterationDelateMenuChildren(shookConfig)\n}\n\n// 获取有权限的舞台配置\nexport const permissionStageConfig = state => {\n  const { stageConfig, permissions, user } = state // eslint-disable-line\n  const tempStageConfig = Util.deepClone(stageConfig)\n  const shookConfig = permissionShaking(tempStageConfig, permissions, user)\n\n  // 设置舞台缓存\n  const list = {}\n  deepTravel(shookConfig, item => {\n    list[item.name] = item\n  })\n  stageMap = list\n  return shookConfig\n}\n\n// 获取侧边栏配置\nexport const sideBarList = (state, getter) => {\n  const { sideBarLevel } = state // eslint-disable-line\n  const { permissionStageConfig } = getter // eslint-disable-line\n\n  function deepGetSideBar(target, level = 3) {\n    // 集合节点处理\n    if (Array.isArray(target)) {\n      const acc = target.map(item => deepGetSideBar(item, level - 1))\n      return acc.filter(item => item !== null)\n    }\n\n    // 检测是否需要在导航中显示\n    if (!target.inNav) {\n      return null\n    }\n\n    if (target.type === 'folder' && level !== 0) {\n      // 处理 folder 模式\n      const sideConfig = {}\n      sideConfig.name = target.name\n      sideConfig.title = target.title\n      sideConfig.icon = target.icon\n      sideConfig.path = target.route || Util.getRandomStr(6)\n      sideConfig.children = target.children.map(item => deepGetSideBar(item, level - 1))\n      sideConfig.children = sideConfig.children.filter(item => item !== null)\n      return sideConfig\n    }\n\n    // 处理一级就是 view 的情况\n    if (target.type === 'view') {\n      const sideConfig = {}\n      sideConfig.name = target.name\n      sideConfig.title = target.title\n      sideConfig.icon = target.icon\n      sideConfig.path = target.route\n      return sideConfig\n    }\n\n    // 处理 appTab 情况\n    if (target.type === 'tab') {\n      const sideConfig = {}\n      sideConfig.name = target.name\n      sideConfig.title = target.title\n      sideConfig.icon = target.icon\n      sideConfig.path = target.route\n      // 如果 Tab 没有设置默认打开的路由, 则设置为第一个子节点路由\n      if (!sideConfig.path) {\n        if (target.children && target.children.length > 0 && target.children[0].route) {\n          sideConfig.path = target.children[0].route\n        }\n      }\n      return sideConfig\n    }\n    // 最后一层, 都当做子节点处理\n    if (level <= 0) {\n      const sideConfig = {}\n      sideConfig.name = target.name\n      sideConfig.title = target.title\n      sideConfig.icon = target.icon\n      sideConfig.path = Util.getRandomStr(6)\n      if (target.children && target.children.length > 0 && target.children[0].route) {\n        sideConfig.path = target.children[0].route\n      }\n      return sideConfig\n    }\n    return null\n  }\n\n  const sideBar = deepGetSideBar(permissionStageConfig, sideBarLevel)\n  return sideBar\n}\n\n// 获取有权限的所有节点配置对象\n// eslint-disable-next-line\nexport const getStageByName = () => {\n  return name => stageMap[name]\n}\n\n// 获取有权限的所有节点配置对象\n// eslint-disable-next-line\nexport const getStageByRoute = () => {\n  return path => {\n    const result = Object.getOwnPropertySymbols(stageMap).find(key => stageMap[key].route === path)\n    return stageMap[result]\n  }\n}\n\nexport const stageList = () => stageMap\n\nexport const permissions = state => state.permissions\n\nexport const getStageInfo = state => {\n  const { stageConfig } = state\n  const cache = {}\n  const findStage = (stages, name) => {\n    let result\n    if (Array.isArray(stages)) {\n      for (let i = 0; i < stages.length; i += 1) {\n        result = findStage(stages[i], name)\n        if (result) {\n          break\n        }\n      }\n      return result\n    }\n\n    if (stages.children && stages.children.length) {\n      result = findStage(stages.children, name)\n      if (result) {\n        result.unshift(stages)\n      }\n      return result\n    }\n\n    if (stages.name === name) {\n      return [stages]\n    }\n    return false\n  }\n  return name => {\n    if (cache[name]) {\n      return cache[name]\n    }\n    const stageInfo = findStage(stageConfig, name)\n    if (stageInfo) {\n      cache[name] = stageInfo\n    }\n    return stageInfo\n  }\n}\n"]}]}
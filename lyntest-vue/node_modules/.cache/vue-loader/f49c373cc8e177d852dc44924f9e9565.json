{"remainingRequest":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/component/base/table/lin-table.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/src/component/base/table/lin-table.vue","mtime":1606834545511},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lyn/Desktop/mmdz_ceshi/lyntest-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import Sortable from 'sortablejs'\n// import FileSaver from 'file-saver'\n\nexport default {\n  props: {\n    tableColumn: {\n      // 表头名称\n      type: Array,\n      default: () => [],\n    },\n    tableData: {\n      // 表格数据\n      type: Array,\n      default: () => [],\n    },\n    operate: {\n      // 自定义按键及绑定方法\n      type: Array,\n      default: () => [],\n    },\n    customColumn: {\n      // 定制要展示的列\n      type: Array,\n      default: () => [],\n    },\n    fixedLeftList: {\n      // 左侧固定列\n      type: Array,\n      default: () => [],\n    },\n    fixedRightList: {\n      // 右侧固定列\n      type: Array,\n      default: () => [],\n    },\n    type: {\n      // 是否开启表格多选\n      type: String,\n      default: null,\n    },\n    index: {\n      // 是否显示索引\n      index: String,\n      default: '',\n    },\n    highlightCurrentRow: {\n      // 是否开启表格单选\n      type: Boolean,\n      default: false,\n    },\n    loading: {\n      // 动画加载\n      type: Boolean,\n      default: false,\n    },\n    loadingText: {\n      // 动画提示\n      type: String,\n      default: '',\n    },\n    loadingIcon: {\n      // 动画图标\n      type: String,\n      default: 'el-icon-loading',\n    },\n    loadingBG: {\n      // 动画背景色\n      type: String,\n      default: 'rgba(255,255,255,0.5)',\n    },\n    pagination: {\n      // 分页\n      type: [Object, Boolean],\n      default: false,\n    },\n    border: {\n      // 边框\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      filterTableColumn: [], // 定制展示的列\n      currentPage: 1, // 当前选中页\n      currentData: [], // 每次切换页码的时候要给table传入不同的数据\n      selectedTableData: [], // 多选选中的数据\n      currentRow: null, // 单选选中的数据\n      oldVal: [], // 上一次选中的数据\n      oldKey: [], // 上一次选中数据的key\n      currentIndex: 1, // 当前索引，切换页面的时候需要重新计算\n      rowClassName: '', // 行样式\n    }\n  },\n  created() {},\n  beforeMount() {\n    // 先放在session里，因为每次切换页码table都会重新渲染，之前选中都数据就丢失了  sessionstorage在create里面打包会提示undefined\n    sessionStorage.setItem('selectedTableData', JSON.stringify([]))\n  },\n  methods: {\n    // 开发者自定义的函数\n    buttonMethods(func, index, row) {\n      const _this = this\n      const { methods } = this.$options\n      methods[func](_this, index, row)\n    },\n    // 行内编辑\n    handleEdit(_this, index, row) {\n      _this.$emit('handleEdit', { index, row })\n    },\n    // 行内删除\n    handleDelete(_this, index, row) {\n      _this.$emit('handleDelete', { index, row })\n    },\n    // 行内跳转页面\n    goToGroupEditPage(_this, index, row) {\n      _this.$emit('goToGroupEditPage', { index, row })\n    },\n    // 多选-选中checkbox\n    toggleSelection(rows, flag) {\n      if (rows) {\n        rows.forEach(row => {\n          this.$refs.linTable.toggleRowSelection(row, flag)\n        })\n      } else {\n        this.$refs.linTable.clearSelection()\n      }\n    },\n    // 全选-取消全选\n    selectAll(val) {\n      this.oldKey = val.map(item => item.key)\n    },\n    // 单选\n    handleCurrentChange(val, oldVal) {\n      this.currentRow = val\n      this.$emit('handleCurrentChange', { val, oldVal })\n    },\n    // 单击某一行\n    rowClick(row) {\n      // eslint-disable-line\n      // 选中-多选\n      if (!this.oldKey.includes(row.key)) {\n        this.oldKey.push(row.key)\n        const data = this.oldVal.concat(row)\n        this.handleSelectionChange(data)\n        // 选中checkbox\n        this.toggleSelection(this.currentData.filter(item => item.key === row.key))\n        // 取消选中\n      } else {\n        this.oldKey = this.oldKey.filter(item => item !== row.key)\n        const data = this.oldVal.filter(item => item.key !== row.key)\n        this.handleSelectionChange(data)\n        this.toggleSelection(\n          this.currentData.filter(item => item.key === row.key),\n          false,\n        )\n      }\n      // 选中-单选\n      if (this.currentOldRow && this.currentOldRow.key === row.key) {\n        // 取消单选选中\n        this.$refs.linTable.setCurrentRow()\n        this.currentOldRow = null\n        return\n      }\n      this.currentOldRow = row\n    },\n    // 切换当前页\n    currentChange(page) {\n      const currentSelectedData = []\n      this.oldVal = []\n      this.currentPage = page\n      this.selectedTableData = JSON.parse(sessionStorage.getItem('selectedTableData'))\n      this.currentData = this.tableData.filter(\n        (item, index) => index >= (this.currentPage) * this.pagination.pageSize\n          && index < this.currentPage * this.pagination.pageSize,\n      ) // eslint-disable-line\n      this.$emit('currentChange', page)\n      // 已选中的数据打勾\n      this.selectedTableData.forEach(item => {\n        for (let i = 0; i < this.currentData.length; i++) {\n          if (this.currentData[i].key === item.key) {\n            // 切换页码重新计算oldVal\n            this.oldVal.push(this.currentData[i])\n            // 需要打勾的数据\n            currentSelectedData.push(this.currentData[i])\n          }\n        }\n      })\n      this.$nextTick(() => {\n        this.toggleSelection(currentSelectedData)\n      })\n      // 切换行索引\n      this.currentIndex = (this.currentPage) * this.pagination.pageSize + 1\n    },\n    // checkbox触发函数\n    handleSelectionChange(val) {\n      const valKeys = val.map(item => item.key)\n      const oldValKeys = this.oldVal.map(item => item.key)\n      this.selectedTableData = JSON.parse(sessionStorage.getItem('selectedTableData'))\n      // 一条数据都没选中\n      if (this.selectedTableData.length === 0) {\n        this.selectedTableData = this.selectedTableData.concat(val)\n        this.$emit('selection-change', this.selectedTableData)\n        this.oldVal = [...val]\n        sessionStorage.setItem('selectedTableData', JSON.stringify(this.selectedTableData))\n        return\n      }\n      // 判断是选中数据还是取消选中\n      if (valKeys.length < oldValKeys.length) {\n        const delKey = oldValKeys.filter(item => !valKeys.includes(item))\n        this.selectedTableData = this.selectedTableData.filter(item => !delKey.includes(item.key))\n        this.$emit('selection-change', this.selectedTableData)\n      } else {\n        const addKey = valKeys.filter(item => !oldValKeys.includes(item))\n        const addVal = val.filter(item => addKey.includes(item.key))\n        this.selectedTableData = this.selectedTableData.concat(addVal)\n        this.$emit('selection-change', this.selectedTableData)\n      }\n      sessionStorage.setItem('selectedTableData', JSON.stringify(this.selectedTableData))\n      this.oldVal = [...val]\n    },\n    // 拖拽\n    // setDrag() {\n    //   const el = document.querySelectorAll('.el-table__body-wrapper > table > tbody')[0]\n    //   this.rowClassName = 'rowClassName' // 设置行样式，添加移动手势\n    //   this.sortable = Sortable.create(el, {\n    //     setData(dataTransfer) {\n    //       dataTransfer.setData('Text', '')\n    //     },\n    //     onEnd: (evt) => {\n    //       const dragData = [...this.currentData]\n    //       let { oldIndex, newIndex } = evt\n    //       if (this.pagination) {\n    //         oldIndex = evt.oldIndex * this.currentPage\n    //         newIndex = evt.newIndex * this.currentPage\n    //       }\n    //       dragData[oldIndex] = this.currentData[newIndex]\n    //       dragData[newIndex] = this.currentData[oldIndex]\n    //       this.$emit('getDragData', { dragData, oldIndex, newIndex })\n    //     },\n    //   })\n    // },\n    // 导出excel\n    // exportExcel(fileName = 'sheet') {\n    //   const targetTable = this.$XLSX.utils.table_to_book(document.querySelectorAll('.el-table__body-wrapper > table')[0])\n    //   const writeTable = this.$XLSX.write(targetTable, { bookType: 'xlsx', bookSST: true, type: 'array' })\n    //   try {\n    //     FileSaver.saveAs(new Blob([writeTable], { type: 'application/octet-stream' }), `${fileName}.xlsx`)\n    //   } catch (e) { if (typeof console !== 'undefined') console.log(e, writeTable) }\n    //   return writeTable\n    // },\n    // 导出csv\n    // exportCsv(fileName = 'sheet') {\n    //   const targetTable = this.$XLSX.utils.table_to_book(document.querySelectorAll('.el-table__body-wrapper > table')[0])\n    //   const writeTable = this.$XLSX.write(targetTable, { bookType: 'csv', bookSST: true, type: 'array' })\n    //   try {\n    //     FileSaver.saveAs(new Blob([writeTable], { type: 'application/octet-stream' }), `${fileName}.csv`)\n    //   } catch (e) { if (typeof console !== 'undefined') console.log(e, writeTable) }\n    //   return writeTable\n    // },\n  },\n  watch: {\n    fixedLeftList: {\n      handler() {\n        // eslint-disable-line\n        this.filterTableColumn.map((item, index) => {\n          if (this.fixedLeftList.indexOf(item.label) > -1) {\n            this.$set(this.filterTableColumn[index], 'fixed', 'left')\n          } else if (this.fixedRightList.indexOf(item.label) === -1) {\n            this.$set(this.filterTableColumn[index], 'fixed', false)\n          }\n          return ''\n        })\n      },\n      deep: true,\n      immediate: true,\n    },\n    fixedRightList: {\n      handler() {\n        // eslint-disable-line\n        this.filterTableColumn.map((item, index) => {\n          if (this.fixedRightList.indexOf(item.label) > -1) {\n            this.$set(this.filterTableColumn[index], 'fixed', 'right')\n          } else if (this.fixedLeftList.indexOf(item.label) === -1) {\n            this.$set(this.filterTableColumn[index], 'fixed', false)\n          }\n          return ''\n        })\n      },\n      deep: true,\n      immediate: true,\n    },\n    customColumn: {\n      handler(val) {\n        if (val.length > 1) {\n          this.filterTableColumn = this.tableColumn.filter(v => val.indexOf(v.label) > -1)\n        }\n      },\n      deep: true,\n    },\n    tableData: {\n      handler() {\n        // 传了分页配置\n        if (this.pagination && this.pagination.pageSize) {\n          this.currentData = this.tableData.filter((item, index) => index < this.pagination.pageSize)\n        } else {\n          this.currentData = this.tableData\n        }\n      },\n      deep: true,\n      immediate: true,\n    },\n    tableColumn: {\n      handler() {\n        // 如果一开始没有传要展示的列 就默认全展示\n        if (this.customColumn.length > 1) {\n          this.filterTableColumn = this.tableColumn.filter(v => this.customColumn.indexOf(v.label) > -1)\n        } else {\n          this.filterTableColumn = this.tableColumn\n        }\n      },\n      deep: true,\n      immediate: true,\n    },\n  },\n}\n",null]}